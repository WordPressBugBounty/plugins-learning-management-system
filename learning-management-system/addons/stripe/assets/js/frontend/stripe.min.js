jQuery(function(l){try{var i=Stripe(_MASTERIYO_STRIPE_.publishableKey,{locale:_MASTERIYO_STRIPE_.locale||"auto"})}catch(e){return void console.log(e)}function o(){return{message:'<span class="spinner" style="visibility:visible"></span>',css:{border:"",width:"0%"},overlayCSS:{background:"#fff",opacity:.6}}}var a,r={$form:l("form.masteriyo-checkout"),getAjaxURL:function(){return _MASTERIYO_STRIPE_.ajaxURL},attachUnloadEventsOnSubmit:function(){l(window).on("beforeunload",this.handleUnloadEvent)},detachUnloadEventsOnSubmit:function(){l(window).off("beforeunload",this.handleUnloadEvent)},unmountElements:function(){},mountElements:function(){},scrollToNotices:function(){var e=l(".masteriyo-NoticeGroup-updateOrderReview, .masteriyo-NoticeGroup-checkout");(e=e.length?e:l("form.masteriyo-checkout")).length&&l("html, body").animate({scrollTop:e.offset().top-100},1e3)},submitError:function(e){l(".masteriyo-NoticeGroup-checkout, .masteriyo-error, .masteriyo-message").remove(),r.$form.prepend('<div class="masteriyo-NoticeGroup masteriyo-NoticeGroup-checkout">'+e+"</div>"),r.$form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),r.scrollToNotices(),l(document.body).trigger("checkout_error",[e])},removePaymentIntentFromCheckoutForm:function(){l("#masteriyo-stripe-payment-intent-id").remove()},fetchPaymentIntent:function(){l.ajax({url:this.getAjaxURL(),method:"POST",data:{action:"masteriyo_stripe_payment_intent"},beforeSend:function(e,t,n){l("#masteriyo-stripe-method").block(o())},success:function(e,t,n){r.createPaymentElement(e.data.clientSecret)},error:function(e,t,n){r.removePaymentIntentFromCheckoutForm(),l("#masteriyo-stripe-method").unblock()},complete:function(e,t){l("#masteriyo-stripe-method").unblock()}})},createPaymentElement:function(e){e=(a=i.elements({clientSecret:e})).create("payment",{wallets:{applePay:"never",googlePay:"never"}});e.mount("#masteriyo-stripe-payment-element"),e.on("change",function(e){var t,n;e.value&&e.value.type&&(0===(t=r.$form.find('input[name="stripe_payment_method"]')).length?(n=l("<input>").attr({type:"hidden",name:"stripe_payment_method",value:e.value.type}),r.$form.append(n)):t.val(e.value.type))})},init:function(){r.$form.length||(r.$form=l("form.masteriyo-checkout")),r.$form.on("checkout_place_order_success",this.confirmPayment),r.$form.on("change",this.reset),l(document).on("stripeError",this.onError).on("checkout_error",this.reset),this.fetchPaymentIntent()},confirmPayment:function(e,t){var n;if(r.isStripeChosen())return r.attachUnloadEventsOnSubmit(),r.$form.block(o()),n=r.getUserDetails(),i.confirmPayment({elements:a,confirmParams:{return_url:t.redirect,payment_method_data:{billing_details:n}}}).then(function(e){r.attachUnloadEventsOnSubmit(),r.$form.unblock(),e.error&&r.submitError(e.error.message)}),!1},isStripeChosen:function(){return 0!==l("#payment-method-stripe:checked").length},getSelectedPaymentElement:function(){return l('.payment_methods input[name="payment_method"]:checked')},getUserDetails:function(){var e=l("#billing-first-name").length?l("#billing-first-name").val():_MASTERIYO_STRIPE_.billingFirstName,t=l("#billing-last-name").length?l("#billing-last-name").val():_MASTERIYO_STRIPE_.billingLastName,n={name:"",address:{},email:"",phone:""},e=(n.name=e,n.name=e&&t?e+" "+t:l("#stripe-payment-data").data("full-name"),n.email=l("#billing-email").val(),n.phone=l("#billing-phone").val(),(void 0===n.phone||n.phone.length<=0)&&delete n.phone,(void 0===n.email||n.email.length<=0)&&(l("#stripe-payment-data").data("email").length?n.email=l("#stripe-payment-data").data("email"):delete n.email),(void 0===n.name||n.name.length<=0)&&delete n.name,l("#billing_address_1").val()||_MASTERIYO_STRIPE_.billingAddress1),t=l("#address-line-two").val()||_MASTERIYO_STRIPE_.billingAddress2,i=l("#billing-state").val()||_MASTERIYO_STRIPE_.billingState,o=l("#billing-town-city").val()||_MASTERIYO_STRIPE_.billingCity,a=l("#billing-zip-code").val()||_MASTERIYO_STRIPE_.billingPostcode,r=l("#billing-county").val()||_MASTERIYO_STRIPE_.billingCountry;return e&&(n.address.line1=e),t&&(n.address.line2=t),i&&(n.address.state=i),o&&(n.address.city=o),a&&(n.address.postal_code=a),r&&(n.address.country=r),n}};r.init()});